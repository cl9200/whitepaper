# MediBloc技术白皮书v0.2

## 概要
MediBloc的个人医疗数据（ health data or healthcare information in English ）平台是一个以患者为中心，收集、管理并灵活应用医疗数据的生态系统。要构建这样一个生态系统，必须保证流通在平台内所有医疗数据的完整性及所有权的验证核实，区块链技术便是解决上述问题的核心要素。区块链是一个分布式账簿，里面包含有密码学签名的交易明细，数据的记录以及验证都是建立在智能合约的基础上，所以数据一旦被成功记录基本上是无法更改的。MediBloc平台利用这一特性，将数据的散列值记录到平台上，提供完整的数据以及所有权验证功能,把加密货币（MED）作为维护区块链网络的经济基础。此外，平台还提供医疗人员验证、数据中介、备份、交易奖励体系等服务，医疗提供者和消费者以及研究人员都可以在MediBloc平台上受益。
上面提到的MediBloc平台功能将通过SDK公开发行，方便第三方程序开发者将现有的应用程序或服务等整合到平台内。

## 区块链
### 共识机制(Consensus mechanism)
MediBloc的区块链采用DPOS（ Delegated Proof of Stake ）共识机制。DPOS最大的优点是拥有强大的数据处理能力（ Transactions per second ），在DPOS共识机制中，持币用户投票选出一定数量的生产者，区块生产者在区块同步化的同时快速生产新的区块。

DPOS共识机制的细节我们参照了该协议方式的先驱Steem和EOS.IO。日后，根据MediBloc平台的具体使用环境，将会有所改动。MediBloc区块链上的生产者由集体投票选出的前21名组成，每轮选定的21人根据各自账户地址，按照规定顺序每隔3秒生成一个区块，区块大小没有规定，但交易规模有限制，如果在区块生成的规定时间内，因处理过多交易而无法生成区块时，生产区块的权利将转移给下一个区块生产者，之前的区块生产者因为无法得到相应的奖励而蒙受经济损失。因此每个区块生产者在指定时间内执行、验证固定数量的交易，每笔交易中，用户都会支付相应的费用，避免恶性生产过大区块。

MediBloc区块链上产生的通胀比例约为每年5%，这些将用于奖励区块生产者。

### 使用租赁模式（ Usage rental model ）

与传统意义上的数据库或存储服务不同，区块链是十分昂贵的存储空间。数据一旦记录在区块链上面，就会上传到全世界的区块链节点上，每个节点上的记录都需要通过真伪验证。数据的原始形态一旦被记录将无法删除或者篡改。因此，在区块链账簿上尽可能地记录对网络具有实际价值的内容就十分重要。

为了解决上述问题，最常用就是按每笔交易付费(pay-per-transaction)的方法。像比特币和以太币等区块链采用这种模式是因为他们本身就是交易货币，每笔新交易都要支付一定的手续费，用来防止恶性用户在区块链上记录无意义的数据。

支付手续费的方式虽然能有效地防止滥用区块链这种有限资源，然而，用户需要对区块链状态（States）变更的所有行为不断支付费用，这就大大阻碍了用户使用这些服务。因此，就需要提供其他方式来保证用户能够更广泛的应用服务。在这个问题上，区块链社区提供了各种备选方案，MediBloc采用的是带宽模式(Bandwidth model)。带宽模式的基本概念是要求用户预存（Staking）一部分相关区块链网络的加密货币，按照一定比列在交易中使用其中一部分，用户可以在指定的时间窗口(Time window)内根据自己的交易情况决定预存多少加密货币，不使用区块链时可以随时提取这部分预存金。

| ![Image of Time window](https://github.com/medibloc/whitepaper/blob/master/images/TimeWindow.png) |
|:--:|
| *Time window* |

带宽模式不仅消除了固定支出、降低了用户应用服务的门槛，还避免用户们为使用区块链而不断购买特定加密货币的弊端。然而，上述的带宽模式十分单一，每位用户想要使用区块链网络就必须持有一定数量的加密货币，这就要求用户必须找到相关交易所购买这些加密货币，这些问题很可能会成为我们服务商业化过程中的绊脚石。

为了解决上述问题，MediBloc决定投入“使用租赁模式”的概念。也就是在区块链上拥有一定使用权限（例如：带宽）的人可以代替他人处理交易。为此，我们提出了二级签名，也可称之为付款人签名(Payer signature)的服务。付款人签名为可选项，如果提交的交易内容中含有付款人签名，区块链生产者将按照二级签名（而并非一级签名者）记录数据。因此，交易明细上面显示二级签名者的交易也会因此消耗一定的带宽。

使用租赁模式中，基于MediBloc平台的服务提供商可以预存大量加密货币，在向用户提供二级签名服务时收取一定数额的加密货币或者法定货币，二级签名的费用条款由服务提供商决定，MediBloc不采取任何强制性措施。

| ![Image of Rental model](https://github.com/medibloc/whitepaper/blob/master/images/RentalModel.png) |
|:--:|
| *Usage rental model* |

使用租赁模式的基本原理不仅适用于带宽模式，也适用于收费模式。在这种情况下，二级签名者的使用权限不再是“租赁”，而是“代收代付”。代收代付模式也有利弊。MediBloc在使用租赁模式和代收代付模式中采用了使用租赁模式，是因为在代收代付模式中，每使用二级签名时加密货币的数量就会减少，同时考虑到二级支付服务的安全性以及维护的便利性等问题时，我们认为使用租赁模式更适合平台。MediBloc的使用租赁模式，使用权限的计算方式与带宽模式的带宽相同。用户可以直接使用加密货币获取一定的带宽。带宽根据用户持有的加密货币数量按网络七天的最大值计算，七天后相应带宽将复原。

### 医疗健康数据的默克尔树(Merkle tree of healthcare data)

在MediBloc平台内，医疗保健数据以默克尔树形态进行处理和保管。 特定格式的健康保健数据(例如：HL7 FHIR)在转换成默克尔树的过程中需要提供对应数据格式的服务，为了实现这一目标， MediBloc将提供相应的软件工具以及指南。

| ![Image of Merkle tree](https://github.com/medibloc/whitepaper/blob/master/images/MerkleTree.png) |
|:--:|
| *HL7 FHIR to Merkle tree* |

使用默克尔树管理数据的优点之一是可以共享数据的部分内容。区块链上的数据所有者在默克尔树上记录根哈希(Root hash)。默克尔树的特征是只要提供默克尔证明（Merkle proof），即使只公开一部分数据也可以验证包括根哈希在内的原始数据的真伪，利用这一特征，在传送数据时，即便没有个人身份信息也能完成非识别化，根据请求者的要求通过公开创建者签名等部分特定数据，借此在交易以前验证相关数据的真伪。

转换为默克尔树的原始数据首先存储在用户的智能手机上，由于根据数据源提取的根哈希已经记录在区块链上，所以数据存储和共享过程中使用的加密化方式不受任何限制。即使加密方式因为计算机能力加大而失去其安全性，也不会影响记录在区块链上的内容，在服务方面也可采用新的加密方法。

### 医疗人员认证(Certification of healthcare professionals)

目前，医疗人员资格认证在各个国家/地区方法都不尽相同，多数地区的自动验证系统并不完善，因此很难构建一个通用的医疗人员认证系统。MediBloc不会构建一个通用的认证系统，而是利用去中心化的方式为每个地区/国家提供一种或多种认证服务。医疗人员的资格认证的“认证主体”和“认证对象”同时记录在区块链上面，用户可以轻松识别这些记录，并通过认证方式判断可信赖程度。

| ![Image of Certification](https://github.com/medibloc/whitepaper/blob/master/images/Certification.png) |
|:--:|
| *Certifications on the blockchain* |

区块链上面会记录哪些账户是医疗人员的账户以及相关认证数据的交易详情，所有人都可以执行认证操作。MediBloc平台上认为自己是医疗人员的用户，在区块链上核实通过哪些认证主体得到医疗人员认证等是否属实。为此，平台上必须存在利用公钥对医疗人员进行身份验证的服务，有关医疗人员认证服务，在后面的章节中会详细阐述。

在区块链上虽然可能存在多个认证主体，但用户也无需每次确认这些认证主体是否可靠。因为在应用程序或者服务等级中，以特定区域内可信赖的公钥认证服务为基础，可以明确判断是否通过医疗人员认证，这些内容将对所有用户公开。

医疗人员认证交易服务中，还包括颁发给医疗人员认证书的散列值以及有效期。在认证书上面详细记录医疗人员的相关信息（例如：专业、所属医院等），当医疗人员向患者发送诊断数据时，这些数据也将一起传送。

### 代币的预存和提取

预存代币的总额与DPOS投票影响力以及区块链网络的带宽使用量成正比 。反之，如果提取预存的加密货币时，投票影响力和使用量将会随之降低。代币预存可以马上到账户，但提取时，提交申请后7天后可以到账。代币提取申请提交的同时，投票影响力以及网络带宽使用量立即相应减少，因为提取申请本身就意味着放弃某些权利。提取时间长的最大原因是为避免DOS攻击，防止有人以短期利益为目在MediBloc平台上通过重复存取代币等行为获取利润。

### 智能合约

MediBloc区块链为了支持上面提到的各种交易功能，根据预定的形式提供复合型交易服务。根据用户定义的数据存储以及更改方式提供相应服务。MediBloc的最初版本不支持“智能合约”功能，为了保障多种健康护理数据的应用软件在MediBloc平台上正常运行，我们在研讨引入智能合约引擎（例如，EVM）的方案。

### 服务

医疗人员认证服务
在区块链上记录医疗人员认证明细的主体必须是得到平台参与者信任的存在体。虽然从整体来说所有人都可以充当身份验证者，但在平台初期，MediBloc团队将直接承担开发运行医疗人员认证服务的角色。想要加入MediBloc平台的医疗人员，必须注册并提交所需资料来证明本人的资格。通过医疗人员验证后，认证服务将颁发给医疗人员证书，并在区块链上记录相应数据，其中包括认证书的散列值和有效日期。其他用户提出请求时，认证服务还具备提供相应认证书内容的服务。

![Image of Certification process](https://github.com/medibloc/whitepaper/blob/master/images/CertificationProcess.png) |
|:--:|
| *Certification process* |

假如持有证书的医疗人员因某些原因丧失资格时，区块链上将会销毁证书，并将这部分内容记录到区块链上，以便参与平台的所有人及时进行确认。随着平台用户数量增加，使用地区不断扩展，平台内不仅有MediBloc团队直接运营的认证服务，还会引进一些可信赖的认证服务应用程序。

### 数据中介和备份服务

健康护理数据如果只存储到个人移动设备中，机器丢失或变更时就存在医疗数据丢失的风险。另外，用户需要直接以点对点（P2P）形式传送个人数据时，移动设备的网络环境不同用户体验也会存在很大差别。为了弥补这一点，就需要一个传送数据和二次备份的服务。这些服务从根本上来说是起到一个中介的作用，负责将专业医疗机构的数据安全的传递给用户，将用户的数据传送给用户希望共享的一方。在此过程中，通过对称密匙算法(Block encryption)对数据进行加密，只有发送方和接收方可以访问内容。为了加密数据密钥，MediBloc区块链采用椭圆曲线 Elliptic-curve Diffie Hellman(ECDH)技法。此外，用户还可以加密后备份，只有本人才能读取数据。这种情况下，需要共享数据时，用户无需把整个数据上传到中介服务器上，接收方可以从备份服务器上下载加密数据，用户（发送方）只需通过数据中介服务共享数据的非对称解密密钥即可。

| ![Image of Data relay](https://github.com/medibloc/whitepaper/blob/master/images/DataRelay.png) |
|:--:|
| *Data transfer* |

此外，如果用户希望在交易中只公开部分特定数据（例如，医疗专家签名）时，将可公开的部分数据保存在备份服务器上，这比每次接到数据请求后再传送的方法更有效。这种方法同样适用于默克尔证明（Merkle proof），如果发送方在数据备份服务上存储了默克尔树，数据接收方可以随时下载默克尔树来判断数据真伪。

### 数据市场服务

数据市场以平台服务的形式提供给用户，根据个人所需，用户可以通过向市场开放自己的部分数据，成为数据销售者。数据购买者设置所需数据的特定关键字，出现符合条件的数据提供者时，提供包括默克尔证明在内的数据进行交易。在双方达成协议并交易成功时，通过加密通信将部分或全部数据以及相应的默克尔证明传送给购买方。通过默克尔证明以及记录在区块链上的根哈希检查数据的真伪，一旦确定数据的真实性，通过转移相应代币完成交易。


## 隐私保护

医疗数据管理中，高度的隐私保护至关重要。MediBloc平台上，每次创建和记录新的医疗保健数据时，为了防止数据泄露，数据传送明细以及数据创建者信息等并不记录在区块链上。数据创建者信息记录在数据原本和默克尔树上，区块链上面只保存默克尔树的根哈希，因此想从公开数据中推断数据创建者是不可能的。相反，接收者可以通过创建包含数据所有者信息在内的默克尔树来验证创建者信息的真伪。 由于数据传送是通过数据中介服务,与区块链是分开执行的，因此无法利用公开信息进行追踪。无论是使用P2P（点对点）形式还是数据中介服务，即使数据被拦截也不会有被泄露的危险，因为数据已被加密只有发送方和接收方可以解密。

在数据交易方面，不会在区块链上一一记录详细的交易内容。数据的移动脱链进行，交易支付等也是通过与区块链不同的系统进行，开通除了MediBloc加密货币以外其他支付方式功能。有效防止没有数据原件的人通过区块链侵犯他人隐私。

最后，为了保障用户的匿名性，用户的个人信息并不记录在区块链上，医疗健康数据在使用默克尔树(Merkle Tree)算法进行无法识别化后再进行共享。


## 结论

MediBloc平台由各种基于区块链技术的组成部分构成，保证用户完全自主控制管理和应用本人的医疗保健数据，MediBloc平台的最终目标是应用区块链技术创建一个完全以患者为中心的医疗生态系统，而MediBloc团队为实现这一目标会不断对平台进行反复验证和修改。

## Roadmap

| ![Image of roadmap](https://github.com/medibloc/whitepaper/blob/master/images/roadmap.png) |
|:--:|
| *MediBloc platform roadmap* |
